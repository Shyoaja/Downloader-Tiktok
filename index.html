<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö´ TIKTOK DOWNLOADER ‚ö™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000000;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 90%;
            padding: 30px;
            border: 3px solid #ffffff;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.95);
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.1);
            position: relative;
        }

        /* Header dengan Foto Profil */
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #ffffff;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.5);
            object-fit: cover;
            margin: 0 auto 15px auto;
            display: block;
        }

        .title {
            font-size: 2.2em;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #cccccc;
            font-size: 1em;
            margin-bottom: 5px;
        }

        /* Menu Titik Tiga */
        .menu-container {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .menu-btn {
            background: none;
            border: 2px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: #ffffff;
            color: #000000;
            transform: scale(1.1);
        }

        .dropdown-menu {
            position: absolute;
            top: 50px;
            right: 0;
            background: #000000;
            border: 2px solid #ffffff;
            border-radius: 10px;
            padding: 15px;
            min-width: 200px;
            display: none;
            z-index: 1000;
            box-shadow: 0 5px 25px rgba(255, 255, 255, 0.2);
        }

        .dropdown-menu.show {
            display: block;
        }

        .menu-item {
            padding: 12px 15px;
            color: #ffffff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
            margin: 5px 0;
        }

        .menu-item:hover {
            background: #ffffff;
            color: #000000;
            transform: translateX(5px);
        }

        .input-section {
            margin: 25px 0;
        }

        .url-input {
            width: 100%;
            padding: 15px;
            background: #000000;
            border: 2px solid #ffffff;
            border-radius: 10px;
            color: #ffffff;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: #ffffff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            background: #111111;
        }

        .url-input::placeholder {
            color: #888888;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }

        .download-btn {
            padding: 18px 25px;
            border: 2px solid #ffffff;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #000000;
            color: #ffffff;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
            background: #ffffff;
            color: #000000;
        }

        .download-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
            border-color: #666666;
            color: #666666;
        }

        .download-btn.video {
            border-color: #ffffff;
        }

        .download-btn.audio {
            border-color: #ffffff;
        }

        .result-section {
            margin: 25px 0;
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .preview {
            width: 100%;
            max-height: 300px;
            border: 2px solid #ffffff;
            border-radius: 10px;
            margin-bottom: 15px;
            background: #111111;
        }

        .info-text {
            text-align: center;
            color: #cccccc;
            font-size: 14px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #333333;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.05);
        }

        .loading {
            text-align: center;
            color: #ffffff;
            font-size: 16px;
            margin: 20px 0;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .error-message {
            text-align: center;
            color: #ffffff;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border: 1px solid #ffffff;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .download-link {
            display: none;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .social-btn {
            padding: 10px 20px;
            background: #000000;
            border: 2px solid #ffffff;
            border-radius: 8px;
            color: #ffffff;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .social-btn:hover {
            background: #ffffff;
            color: #000000;
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .title {
                font-size: 1.8em;
            }

            .profile-image {
                width: 80px;
                height: 80px;
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .download-btn {
                padding: 15px 20px;
            }

            .social-links {
                flex-direction: column;
                align-items: center;
            }

            .social-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Menu Titik Tiga -->
        <div class="menu-container">
            <button class="menu-btn" onclick="toggleMenu()">‚ãØ</button>
            <div class="dropdown-menu" id="dropdownMenu">
                <a href="https://whatsapp.com/channel/0029Vb671dlLSmbYLGkEew44" class="menu-item" target="_blank">
                    üì± WhatsApp Channel
                </a>
                <a href="https://www.tiktok.com/@shyonotsepuh" class="menu-item" target="_blank">
                    üéµ TikTok Profile
                </a>
                <a href="#" class="menu-item" onclick="showInfo()">
                    ‚ÑπÔ∏è About Tool
                </a>
            </div>
        </div>

        <!-- Header dengan Foto Profil -->
        <div class="profile-header">
            <img src="https://files.catbox.moe/2ib7n3.jpg" alt="Profile" class="profile-image">
            <div class="title">‚ö´ TIKTOK DOWNLOADER ‚ö™</div>
            <div class="subtitle">Download Video & MP3 tanpa watermark</div>
            <div class="subtitle">By: ShyoCode</div>
        </div>

        <div class="input-section">
            <input type="text" class="url-input" id="tiktokUrl" placeholder="Paste TikTok URL disini... (https://vt.tiktok.com/xxx)">
        </div>

        <div class="button-group">
            <button class="download-btn video" onclick="downloadVideo()" disabled>
                üì• Download Video
            </button>
            <button class="download-btn audio" onclick="downloadAudio()" disabled>
                üéµ Download MP3
            </button>
        </div>

        <div class="loading" id="loading">
            ‚ö° Memproses download... Harap tunggu!
        </div>

        <div class="error-message" id="errorMessage">
            ‚ùå Error: URL TikTok tidak valid atau terjadi masalah!
        </div>

        <div class="result-section" id="resultSection">
            <div class="info-text">
                ‚úÖ Download berhasil! File akan otomatis terdownload.
            </div>
        </div>

        <!-- Hidden download link -->
        <a id="downloadLink" class="download-link"></a>

        <!-- Social Links Footer -->
        <div class="social-links">
            <a href="https://www.tiktok.com/@shyonotsepuh" class="social-btn" target="_blank">
                üéµ Follow TikTok
            </a>
            <a href="https://whatsapp.com/channel/0029Vb671dlLSmbYLGkEew44" class="social-btn" target="_blank">
                üì± Join WhatsApp
            </a>
        </div>
    </div>

    <script>
        // Menu Toggle
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('dropdownMenu');
            const menuBtn = document.querySelector('.menu-btn');

            if (!menu.contains(event.target) && !menuBtn.contains(event.target)) {
                menu.classList.remove('show');
            }
        });

        function showInfo() {
            alert('TikTok Downloader v1.0\n\nFitur:\n‚Ä¢ Download video tanpa watermark\n‚Ä¢ Download audio MP3\n‚Ä¢ Support semua format TikTok\n‚Ä¢ By: @malzjomok\n\nFollow untuk update terbaru!');
            toggleMenu(); // Close menu after showing info
        }

        // Enable buttons when URL is entered
        document.getElementById('tiktokUrl').addEventListener('input', function() {
            const url = this.value.trim();
            const videoBtn = document.querySelector('.download-btn.video');
            const audioBtn = document.querySelector('.download-btn.audio');

            const isValid = url.includes('tiktok.com') && url.length > 10;

            videoBtn.disabled = !isValid;
            audioBtn.disabled = !isValid;
        });

        // Download Functions - FIXED VERSION
        async function downloadVideo() {
            const url = document.getElementById('tiktokUrl').value.trim();
            if (!url) return;

            showLoading();
            hideError();

            try {
                // Using external TikTok downloader API
                const downloadUrl = await getDownloadLink(url, 'video');

                if (downloadUrl) {
                    // FIXED: Proper download dengan fetch dan blob
                    await downloadFile(downloadUrl, 'tiktok_video.mp4', 'video/mp4');
                    showResult();
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Download error:', error);
                showError();
            } finally {
                hideLoading();
            }
        }

        async function downloadAudio() {
            const url = document.getElementById('tiktokUrl').value.trim();
            if (!url) return;

            showLoading();
            hideError();

            try {
                // Using external TikTok downloader API for audio
                const downloadUrl = await getDownloadLink(url, 'audio');

                if (downloadUrl) {
                    // FIXED: Proper download dengan fetch dan blob
                    await downloadFile(downloadUrl, 'tiktok_audio.mp3', 'audio/mpeg');
                    showResult();
                } else {
                    showError();
                }
            } catch (error) {
                console.error('Download error:', error);
                showError();
            } finally {
                hideLoading();
            }
        }

        // FIXED: Proper download function dengan blob
        async function downloadFile(fileUrl, fileName, mimeType) {
            try {
                // Fetch file sebagai blob
                const response = await fetch(fileUrl);
                if (!response.ok) throw new Error('Network response was not ok');

                const blob = await response.blob();

                // Create blob URL
                const blobUrl = window.URL.createObjectURL(blob);

                // Create download link
                const downloadLink = document.getElementById('downloadLink');
                downloadLink.href = blobUrl;
                downloadLink.download = fileName;
                downloadLink.style.display = 'block';

                // Trigger download
                downloadLink.click();

                // Cleanup
                setTimeout(() => {
                    window.URL.revokeObjectURL(blobUrl);
                    downloadLink.style.display = 'none';
                }, 100);

            } catch (error) {
                console.error('Download file error:', error);
                // Fallback: Direct download link
                const downloadLink = document.getElementById('downloadLink');
                downloadLink.href = fileUrl;
                downloadLink.download = fileName;
                downloadLink.target = '_blank';
                downloadLink.style.display = 'block';
                downloadLink.click();
                downloadLink.style.display = 'none';
                downloadLink.target = '';
            }
        }

        // Get download link from TikTok API service
        async function getDownloadLink(tiktokUrl, type) {
            // Using multiple API services as fallback
            const apis = [
                `https://www.tikwm.com/api/?url=${encodeURIComponent(tiktokUrl)}`,
                `https://tikdown.org/api?url=${encodeURIComponent(tiktokUrl)}`,
                `https://api.tikmate.app/api/lookup?url=${encodeURIComponent(tiktokUrl)}`
            ];

            for (let api of apis) {
                try {
                    const response = await fetch(api);
                    const data = await response.json();

                    if (type === 'video' && data.data && data.data.play) {
                        return data.data.play;
                    } else if (type === 'audio' && data.data && data.data.music) {
                        return data.data.music;
                    } else if (type === 'video' && data.play) {
                        return data.play;
                    } else if (type === 'audio' && data.music) {
                        return data.music;
                    }
                } catch (error) {
                    console.log(`API ${api} failed, trying next...`);
                    continue;
                }
            }

            return null;
        }

        // UI Helper Functions
        function showLoading() {
            document.getElementById('loading').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('show');
        }

        function showError() {
            document.getElementById('errorMessage').classList.add('show');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('show');
        }

        function showResult() {
            const resultSection = document.getElementById('resultSection');
            resultSection.classList.add('show');
            setTimeout(() => {
                resultSection.classList.remove('show');
            }, 3000);
        }

        // Enter key support
        document.getElementById('tiktokUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                downloadVideo();
            }
        });
    </script>
</body>
  </html>
